<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farbkonverter</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <meta name="theme-color" content="#000000">
    <meta name="color-scheme" content="light">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script>
      // Service Worker Registrierung
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('sw.js')
            .catch(err => console.log('SW Fehler:', err));
        });
      }
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>

/* Fix für PWA-Ränder */
    html {background-color: #000000 !important;}
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FFB1B0;
            transition: background-color 0.3s ease;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #d1d5db;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
            border-radius: 9999px;
        }

        input[type="range"]:hover {
            opacity: 1;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #60a5fa;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 2px rgba(0,0,0,0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #60a5fa;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 2px rgba(0,0,0,0.2);
        }

        .color-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
        }

        .color-item:last-child {
            border-bottom: none;
        }

        .color-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-2 sm:p-4">

    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl overflow-hidden p-4 sm:p-8 mb-4 sm:mb-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-4 sm:mb-6">Farbkonverter</h1>
        
        <div class="mb-3 sm:mb-4">
            <label for="hexInput" class="block text-gray-700 font-medium text-sm sm:text-base mb-1">Hexadezimal (#RRGGBB)</label>
            <input type="text" id="hexInput" placeholder="#FFFFFF" maxlength="7" class="w-full px-3 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-sm sm:text-base">
        </div>

        <div class="mb-3 sm:mb-4">
            <label class="block text-gray-700 font-medium text-sm sm:text-base mb-1">RGB (R, G, B)</label>
            <div class="flex gap-2">
                <input type="number" id="rgbR" placeholder="R" min="0" max="255" class="w-1/3 px-3 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-sm sm:text-base text-center">
                <input type="number" id="rgbG" placeholder="G" min="0" max="255" class="w-1/3 px-3 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-sm sm:text-base text-center">
                <input type="number" id="rgbB" placeholder="B" min="0" max="255" class="w-1/3 px-3 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-sm sm:text-base text-center">
            </div>
        </div>
        
        <div class="mb-3 sm:mb-4">
            <label for="ralInput" class="block text-gray-700 font-medium text-sm sm:text-base mb-1">RAL (Classic)</label>
            <input type="text" id="ralInput" placeholder="RAL 1000" class="w-full px-3 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-sm sm:text-base">
            <p id="ralNotification" class="text-xs sm:text-sm mt-1 min-h-[1.25rem]"></p>
        </div>
        
        <div class="mb-3 sm:mb-4">
            <label for="commonDecimalInput" class="block text-gray-700 font-medium text-sm sm:text-base mb-1">Dezimalwert (Basis-Konvertierung)</label>
            <input type="text" id="commonDecimalInput" placeholder="16777215" class="w-full px-3 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-sm sm:text-base">
        </div>

        <div class="mb-3 sm:mb-4">
            <label for="accessDecimalInput" class="block text-gray-700 font-medium text-sm sm:text-base mb-1">Dezimalwert (Access-Konvertierung)</label>
            <input type="text" id="accessDecimalInput" placeholder="16777215" class="w-full px-3 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 text-sm sm:text-base">
        </div>
        
        <div class="mb-3 sm:mb-4 flex flex-col gap-2">
            <div>
                <label class="block text-gray-700 font-medium text-sm sm:text-base mb-1">Rot</label>
                <input type="range" id="redSlider" min="0" max="255" value="255" class="bg-red-400 focus:ring-red-500">
            </div>
            <div>
                <label class="block text-gray-700 font-medium text-sm sm:text-base mb-1">Grün</label>
                <input type="range" id="greenSlider" min="0" max="255" value="255" class="bg-green-400 focus:ring-green-500">
            </div>
            <div>
                <label class="block text-gray-700 font-medium text-sm sm:text-base mb-1">Blau</label>
                <input type="range" id="blueSlider" min="0" max="255" value="255" class="bg-blue-400 focus:ring-blue-500">
            </div>
        </div>

        <div id="colorDisplay" class="w-full h-24 sm:h-32 rounded-xl border border-gray-300 flex items-center justify-center text-lg sm:text-2xl font-bold transition duration-300 ease-in-out transform scale-100 hover:scale-105" style="background-color: #ffffff;">
        </div>
    </div>
    
    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl overflow-hidden p-4 sm:p-8">
        <h2 class="text-xl sm:text-2xl font-bold text-center text-gray-800 mb-4">RAL Classic-Farbwerte</h2>
        <div id="ralList" class="overflow-y-auto max-h-[500px] border border-gray-200 rounded-xl">
            </div>
    </div>

    <script>
        const ralToRgb = {
            "1000": "203, 196, 134", "1001": "207, 189, 142", "1002": "211, 180, 114", "1003": "231, 169, 58",
            "1004": "224, 151, 19", "1005": "173, 119, 39", "1006": "220, 147, 43", "1007": "212, 117, 40",
            "1011": "146, 113, 85", "1012": "219, 175, 59", "1013": "233, 222, 203", "1014": "229, 212, 188",
            "1015": "231, 211, 191", "1016": "223, 225, 41", "1017": "243, 185, 44", "1018": "246, 212, 0",
            "1019": "145, 126, 107", "1020": "136, 115, 80", "1021": "241, 189, 19", "1023": "245, 188, 0",
            "1024": "194, 147, 65", "1027": "151, 111, 0", "1028": "252, 174, 0", "1032": "236, 189, 12",
            "1033": "246, 170, 0", "1034": "240, 175, 47", "1036": "255, 153, 0", "1037": "242, 164, 0",
            "2000": "234, 107, 10", "2001": "206, 75, 30", "2002": "177, 67, 40", "2003": "255, 107, 46",
            "2004": "244, 76, 38", "2005": "255, 50, 40", "2007": "255, 112, 45", "2008": "250, 106, 42",
            "2009": "203, 76, 23", "2010": "228, 84, 10", "2011": "211, 75, 0", "2012": "207, 72, 43",
            "3000": "164, 38, 38", "3001": "144, 34, 38", "3002": "155, 35, 38", "3003": "134, 35, 39",
            "3004": "100, 39, 42", "3005": "91, 35, 40", "3007": "74, 39, 40", "3009": "99, 46, 42",
            "3011": "104, 37, 34", "3012": "167, 108, 101", "3013": "131, 62, 59", "3014": "218, 150, 148",
            "3015": "201, 156, 161", "3016": "184, 83, 85", "3017": "222, 105, 116", "3018": "200, 69, 74",
            "3020": "207, 26, 39", "3022": "199, 87, 85", "3024": "249, 0, 0", "3026": "255, 0, 0",
            "3027": "175, 23, 30", "3028": "202, 23, 23", "3031": "179, 43, 44", "4001": "128, 77, 112",
            "4002": "127, 48, 85", "4003": "216, 126, 167", "4004": "118, 43, 77", "4005": "70, 64, 94",
            "4006": "158, 48, 103", "4007": "70, 50, 70", "4008": "153, 50, 101", "4009": "125, 99, 122",
            "4010": "188, 76, 126", "5000": "49, 80, 116", "5001": "26, 60, 94", "5002": "3, 47, 98",
            "5003": "36, 46, 68", "5004": "42, 45, 59", "5005": "24, 76, 121", "5007": "77, 104, 137",
            "5008": "44, 49, 58", "5009": "26, 52, 79", "5010": "0, 93, 135", "5011": "0, 48, 70",
            "5012": "22, 116, 154", "5013": "31, 55, 77", "5014": "93, 117, 142", "5015": "23, 93, 146",
            "5017": "0, 89, 128", "5018": "50, 140, 140", "5019": "28, 75, 111", "5020": "0, 67, 92",
            "5021": "0, 94, 112", "5022": "40, 45, 77", "5023": "70, 121, 143", "5024": "110, 152, 172",
            "5025": "12, 101, 128", "6000": "51, 87, 81", "6001": "55, 96, 66", "6002": "41, 88, 46",
            "6003": "72, 80, 62", "6004": "38, 64, 57", "6005": "37, 63, 56", "6006": "53, 62, 59",
            "6007": "44, 55, 50", "6008": "64, 62, 51", "6009": "44, 53, 47", "6010": "77, 110, 55",
            "6011": "93, 115, 87", "6012": "37, 51, 51", "6013": "86, 85, 68", "6014": "64, 59, 49",
            "6015": "53, 57, 56", "6016": "38, 84, 72", "6017": "77, 134, 78", "6018": "90, 169, 61",
            "6019": "173, 203, 141", "6020": "53, 61, 52", "6021": "145, 167, 133", "6022": "43, 40, 36",
            "6024": "0, 112, 86", "6025": "109, 123, 67", "6026": "0, 69, 62", "6027": "117, 168, 175",
            "6028": "36, 125, 96", "6029": "0, 102, 68", "6032": "0, 145, 92", "6033": "121, 140, 152",
            "6034": "100, 155, 178", "6035": "24, 65, 59", "6036": "37, 59, 56", "6037": "27, 85, 85",
            "6038": "0, 255, 0", "7000": "131, 143, 149", "7001": "131, 139, 140", "7002": "112, 116, 105",
            "7003": "119, 122, 106", "7004": "153, 153, 153", "7005": "91, 98, 93", "7006": "109, 102, 94",
            "7008": "105, 97, 82", "7009": "79, 83, 79", "7010": "78, 82, 80", "7011": "76, 82, 86",
            "7012": "75, 80, 81", "7013": "70, 68, 64", "7015": "81, 84, 88", "7016": "53, 61, 64",
            "7021": "45, 49, 53", "7022": "57, 56, 51", "7023": "131, 129, 114", "7024": "64, 68, 71",
            "7026": "58, 66, 73", "7030": "144, 142, 136", "7031": "100, 107, 114", "7032": "153, 153, 140",
            "7033": "126, 131, 119", "7034": "134, 126, 105", "7035": "199, 201, 195", "7036": "145, 143, 143",
            "7037": "119, 122, 120", "7038": "149, 155, 152", "7039": "74, 76, 75", "7040": "117, 121, 125",
            "7042": "119, 124, 127", "7043": "81, 82, 81", "7044": "155, 161, 161", "7045": "156, 159, 160",
            "7046": "125, 129, 131", "7047": "212, 214, 215", "7048": "104, 110, 108", "8000": "144, 115, 78",
            "8001": "130, 94, 68", "8002": "108, 79, 63", "8003": "127, 91, 68", "8004": "132, 73, 50",
            "8007": "103, 76, 53", "8008": "90, 68, 49", "8011": "97, 68, 55", "8012": "76, 44, 38",
            "8014": "69, 52, 47", "8015": "90, 54, 42", "8016": "68, 45, 38", "8017": "74, 49, 44",
            "8019": "43, 44, 43", "8022": "49, 47, 44", "8023": "143, 115, 87", "8024": "124, 88, 64",
            "8025": "120, 93, 73", "8028": "81, 57, 43", "9001": "244, 239, 230", "9002": "233, 230, 219",
            "9003": "243, 243, 240", "9004": "42, 43, 44", "9005": "0, 0, 0", "9006": "169, 172, 171",
            "9007": "133, 138, 140", "9010": "255, 255, 255", "9011": "41, 41, 43", "9016": "246, 246, 242",
            "9017": "69, 69, 69", "9018": "214, 215, 209"
        };
        const ralPrefix = "RAL ";

        const hexInput = document.getElementById('hexInput');
        const rgbR = document.getElementById('rgbR');
        const rgbG = document.getElementById('rgbG');
        const rgbB = document.getElementById('rgbB');
        const ralInput = document.getElementById('ralInput');
        const commonDecimalInput = document.getElementById('commonDecimalInput');
        const accessDecimalInput = document.getElementById('accessDecimalInput');
        const colorDisplay = document.getElementById('colorDisplay');
        const redSlider = document.getElementById('redSlider');
        const greenSlider = document.getElementById('greenSlider');
        const blueSlider = document.getElementById('blueSlider');
        const ralNotification = document.getElementById('ralNotification');
        const ralListDiv = document.getElementById('ralList');

        let isUpdating = false;

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : null;
        }

        function rgbToHex(rgb) {
            const parts = rgb.split(',').map(part => parseInt(part.trim()));
            if (parts.length !== 3 || parts.some(isNaN)) return null;
            const toHex = (c) => {
                const hex = Math.max(0, Math.min(255, c)).toString(16);
                return hex.length === 1 ? "0" + hex : hex;
            };
            return `#${toHex(parts[0])}${toHex(parts[1])}${toHex(parts[2])}`.toUpperCase();
        }

        function rgbToCommonDecimal(rgbString) {
            const parts = rgbString.split(',').map(Number);
            if (parts.length !== 3 || parts.some(isNaN)) return null;
            const r = parts[0];
            const g = parts[1];
            const b = parts[2];
            return (r * 65536) + (g * 256) + b;
        }

        function rgbToAccessValue(rgbString) {
            const parts = rgbString.split(',').map(Number);
            if (parts.length !== 3 || parts.some(isNaN)) return null;
            const r = parts[0];
            const g = parts[1];
            const b = parts[2];
            return (b * 65536) + (g * 256) + r;
        }

        function decimalToRgb(decValue) {
            if (isNaN(decValue)) return null;
            const r = (decValue >> 16) & 255;
            const g = (decValue >> 8) & 255;
            const b = decValue & 255;
            return `${r}, ${g}, ${b}`;
        }

        function findClosestRal(rgbString) {
            const inputRgb = rgbString.split(',').map(Number);
            if (inputRgb.some(isNaN)) return null;

            let closestCode = '';
            let minDistance = Infinity;

            for (const code in ralToRgb) {
                const ralRgb = ralToRgb[code].split(',').map(Number);
                const rDiff = inputRgb[0] - ralRgb[0];
                const gDiff = inputRgb[1] - ralRgb[1];
                const bDiff = inputRgb[2] - ralRgb[2];
                const distance = Math.sqrt(rDiff * rDiff + gDiff * gDiff + bDiff * bDiff);

                if (distance < minDistance) {
                    minDistance = distance;
                    closestCode = code;
                }
            }

            return {
                code: closestCode,
                distance: minDistance
            };
        }
        
        function updateAllFromRgb(rgbString) {
            const rgb = rgbString.split(',').map(part => parseInt(part.trim()));
            if (rgb.length !== 3 || rgb.some(isNaN)) return;
            
            isUpdating = true;
            
            const hex = rgbToHex(rgbString);
            const commonDec = rgbToCommonDecimal(rgbString);
            const accessDec = rgbToAccessValue(rgbString);

            hexInput.value = hex;
            rgbR.value = rgb[0];
            rgbG.value = rgb[1];
            rgbB.value = rgb[2];
            commonDecimalInput.value = commonDec;
            accessDecimalInput.value = accessDec;
            colorDisplay.style.backgroundColor = hex;

            redSlider.value = rgb[0];
            greenSlider.value = rgb[1];
            blueSlider.value = rgb[2];

            // Update RAL notification
            const exactRalCode = Object.keys(ralToRgb).find(key => ralToRgb[key] === rgbString);
            if (exactRalCode) {
                ralInput.value = `${ralPrefix}${exactRalCode}`;
                ralNotification.textContent = 'RAL-Farbe gefunden!';
                ralNotification.classList.remove('text-red-500');
                ralNotification.classList.add('text-black');
            } else {
                const closestRal = findClosestRal(rgbString);
                ralInput.value = ''; // Clear RAL input for non-exact match
                ralNotification.textContent = `Näherungswert: RAL ${closestRal.code} (Abstand: ${closestRal.distance.toFixed(2)})`;
                ralNotification.classList.remove('text-black');
                ralNotification.classList.add('text-red-500');
            }
            
            isUpdating = false;
        }
        
        function updateFromSliders(e) {
            if (isUpdating) return;
            
            // Verhindert Tastatur-Einblendung durch Entfernen des Fokus von Textfeldern
            if (document.activeElement && document.activeElement.tagName === 'INPUT' && document.activeElement.type === 'text') {
                document.activeElement.blur();
            }

            const r = redSlider.value;
            const g = greenSlider.value;
            const b = blueSlider.value;
            const rgbString = `${r}, ${g}, ${b}`;
            updateAllFromRgb(rgbString);

            // Fokus auf dem aktuellen Slider halten
            if (e && e.target) {
                e.target.focus();
            }
        }

        function updateFromHex() {
            if (isUpdating) return;
            let hex = hexInput.value.trim().toUpperCase();
            if (hex.length === 6 && !hex.startsWith('#')) hex = '#' + hex;
            const rgb = hexToRgb(hex);
            if (rgb) {
                updateAllFromRgb(rgb);
            }
        }

        function updateFromRgbInputs() {
            if (isUpdating) return;
            const r = rgbR.value || 0;
            const g = rgbG.value || 0;
            const b = rgbB.value || 0;
            const rgbString = `${r}, ${g}, ${b}`;
            if (rgbToHex(rgbString)) {
                updateAllFromRgb(rgbString);
            }
        }
        
        function updateFromRal() {
            if (isUpdating) return;
            let ralCode = ralInput.value.trim().toUpperCase();
            if (ralCode.startsWith(ralPrefix.toUpperCase())) {
                ralCode = ralCode.substring(ralPrefix.length);
            }
            const rgb = ralToRgb[ralCode];
            if (rgb) {
                updateAllFromRgb(rgb);
                ralNotification.textContent = `RAL ${ralCode} gefunden.`;
                ralNotification.classList.remove('text-red-500');
                ralNotification.classList.add('text-black');
            } else {
                ralNotification.textContent = 'RAL-Farbe nicht in der Datenbank.';
                ralNotification.classList.remove('text-black');
                ralNotification.classList.add('text-red-500');
            }
        }
        
        function updateFromCommonDecimal() {
            if (isUpdating) return;
            const decValue = parseInt(commonDecimalInput.value.trim(), 10);
            const rgb = decimalToRgb(decValue);
            if (rgb) {
                updateAllFromRgb(rgb);
            }
        }

        function updateFromAccessDecimal() {
            if (isUpdating) return;
            const decValue = parseInt(accessDecimalInput.value.trim(), 10);
            const r = decValue & 255;
            const g = (decValue >> 8) & 255;
            const b = (decValue >> 16) & 255;
            const rgb = `${r}, ${g}, ${b}`;
            updateAllFromRgb(rgb);
        }

        function populateRalList() {
            const ralArray = Object.keys(ralToRgb).map(key => ({
                code: key,
                rgb: ralToRgb[key],
            }));

            ralArray.sort((a, b) => a.code - b.code);

            ralListDiv.innerHTML = '';
            ralArray.forEach(color => {
                const hexString = rgbToHex(color.rgb);
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('color-item', 'hover:bg-gray-100');
                itemDiv.innerHTML = `
                    <div class="color-circle" style="background-color: ${hexString};"></div>
                    <span class="text-sm sm:text-base text-gray-800 font-medium">RAL ${color.code}</span>
                `;
                
                itemDiv.addEventListener('click', () => {
                    ralInput.value = `RAL ${color.code}`;
                    updateFromRal();
                });

                ralListDiv.appendChild(itemDiv);
            });
        }

        // Events
        hexInput.addEventListener('input', updateFromHex);
        rgbR.addEventListener('input', updateFromRgbInputs);
        rgbG.addEventListener('input', updateFromRgbInputs);
        rgbB.addEventListener('input', updateFromRgbInputs);
        ralInput.addEventListener('input', updateFromRal);
        commonDecimalInput.addEventListener('input', updateFromCommonDecimal);
        accessDecimalInput.addEventListener('input', updateFromAccessDecimal);
        
        // Listener angepasst für Event-Übergabe
        redSlider.addEventListener('input', (e) => updateFromSliders(e));
        greenSlider.addEventListener('input', (e) => updateFromSliders(e));
        blueSlider.addEventListener('input', (e) => updateFromSliders(e));

        document.addEventListener('DOMContentLoaded', () => {
            updateAllFromRgb('255, 255, 255');
            populateRalList();
        });
    </script>
</body>
</html>
